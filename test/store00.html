<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Indexed Memory Store</title>
    <style type="text/css">
      @import "../../dijit/themes/claro/claro.css";
      @import "../../dijit/themes/claro/document.css";
      @import "../../dijit/tests/css/dijitTests.css";
    </style>

    <script type="text/javascript">
      var dojoConfig = {
            async: true,
            parseOnLoad: true,
            isDebug: true,
            baseUrl: "../../",
            packages: [
              { name: "dojo",  location: "dojo" },
              { name: "store", location: "indexedStore" }
            ]
      };
    </script>

    <script type="text/javascript" src="../../dojo/dojo.js"></script>
    <script type="text/javascript">
      require([
        "dojo/_base/lang",
        "dojo/ready",
        "store/_base/KeyRange",
        "store/_base/TransactionMgr",
        "store/Hierarchy",
        "store/_base/Library",
        "store/_base/Keys"
        ], function( lang, ready, KeyRange, Manager, Memory, lib, Keys) {

          var store = new Memory( { url:"../json/Simpsons.json",
																		 autoIncrement:true,
																		 suppressEvents:true,
																		 name:"peter",
																		 keyPath:"name"
																		});
					function again(transaction) {
console.log("Inside transaction again");
					}


					function callme( transaction ) {
console.log("Inside transaction callback");
						Manager.transaction( store, again, 1);
						var myStore = transaction.objectStore("peter");
						var abc = myStore.get("Bart");
						myStore.put(abc);
console.log("callback done");
					}

					function start () {
						console.log("Store Ready");

						var abc = ["", ["abc"]];
						var bcd = ["", "abc", "bcd"];

						var c = Keys.cmp(abc, bcd);
						
						var trans = Manager.transaction( this, callme );
						
						var index = store.index("parents");
						var abc = index.get("Homer");
						var id = store.getIdentity(abc);

						var key = KeyRange.bound("Homer","Marge");
//						store.remove(id);
						
						console.log("end");

					}
					
					store.ready( lang.hitch( store, start ), function (err) {console.error(err);});
      });
    </script>

  </head>

  <body class="claro">
    <h1 class="DemoTitle">Indexed Memory Store</h1>
  </body>
</html>