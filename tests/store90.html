<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>The CheckBox Tree with multi-parented Evented Store</title>
		<style type="text/css">
			@import "../../dijit/themes/claro/claro.css";
			@import "../../dijit/themes/claro/document.css";
			@import "../../dijit/tests/css/dijitTests.css";
			@import "../../cbtree/themes/claro/claro.css";
		</style>

		<script type="text/javascript">
			var dojoConfig = {
						async: true,
						parseOnLoad: true,
						isDebug: false,
						baseUrl: "../../",
						packages: [
							{ name: "dojo",	location: "dojo" },
							{ name: "dijit", location: "dijit" },
							{ name: "cbtree", location: "cbtree" },
							{ name: "store", location: "store" }
						]
			};
		</script>

		<script type="text/javascript" src="../../dojo/dojo.js"></script>
		<script type="text/javascript">
			require([
				"dojo/_base/lang",
				"dojo/ready",
				"dojo/dom",
				"cbtree/Tree",
				"cbtree/model/TreeStoreModel",
				"store/NaturalHierarchy"
				], function( lang, ready, dom, Tree, TreeStoreModel, Hierarchy ) {

					var store = new Hierarchy( { url:"../json/Simpsons.json",
																				autoIncrement:true,
																				suppressEvents:true,
																				keyPath:"name"
																			});
					var model = new TreeStoreModel({store:store, 
																					 checkedRoot: true,
																					 query:{name:"Root"}});
					var tree	= new Tree( {model:model}, "CheckboxTree");
					tree.on("checkBoxClick", checkBoxClick );
					tree.on("click", click );
					tree.startup();

					function click( item, node, evt ) {
						var descendants = store.getDescendants(item);
						var ancestors	 = store.getAncestors(item, true);
						var siblings		= store.getSiblings(item);

						var isDecendant = store.isDescendantOf(item,"Abe");
						var isAncestor	= store.isAncestorOf("Abe", item);
						var isChildOf   = store.isChildOf(item, "Homer");
						var isSibling   = store.isSiblingOf(item, "Bart");

						var paths = store.getPaths( item );
						if (paths.length) {
							var intersect = paths.intersect();
							var contains	= paths.contains( /Abe/);
							var segments	= paths.segments();
						}
					}
					
					function checkBoxClick( item, node, evt ) {
//						console.log( "Item: "+item.name+" was clicked, checked: "+item.checked);
/*
						var cursor = store.openCursor();
						if (cursor && cursor.value) {
							do {
								console.log( cursor.value.name );
								value = cursor.value;
								value.checked = false;
								cursor.update(value);
							} while (cursor.continue());
						}
*/
					}

					function start () {
						var abc = store
						console.log( "Store is ready and loaded with " + store.count() + " records.");
						this.set("suppressEvents", false );
					}
					store.ready( lang.hitch( store, start ), function (err) {console.error(err);});
			});
		</script>

	</head>

	<body class="claro">
		<h1 class="DemoTitle">The CheckBox Tree with Multi State CheckBoxes</h1>
		<p>
			A CheckBox Tree using an Evented cbtree/store Object Store. The store is loading the data using a URL<br/>
		</p>
		<div id="CheckboxTree">
		</div>
	</body>
</html>